<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }} | StrongKeep</title>
  <meta name="description" content="{{ description }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400;1,9..40,500&family=DM+Serif+Display:ital@0;1&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>

<body>

  <!-- FULL-SCREEN NETWORK BACKGROUND -->
  <div class="network-bg hidden-mobile">
    <canvas id="networkCanvas"></canvas>
  </div>

  <div class="page-wrapper">

    {% include "partials/navbar.html" %}

    {{ content | safe }}

    {% include "partials/footer.html" %}

  </div>

  <!-- GSAP CDN -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12/dist/ScrollTrigger.min.js"></script>

  <script>
    gsap.registerPlugin(ScrollTrigger);

    // ===== MOBILE MENU =====
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
    const mobileMenuClose = document.getElementById('mobileMenuClose');

    function openMobileMenu() {
      mobileMenu.classList.add('active');
      mobileMenuOverlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeMobileMenu() {
      mobileMenu.classList.remove('active');
      mobileMenuOverlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    hamburgerBtn.addEventListener('click', openMobileMenu);
    mobileMenuClose.addEventListener('click', closeMobileMenu);
    mobileMenuOverlay.addEventListener('click', closeMobileMenu);

    // Close menu when clicking a link
    document.querySelectorAll('.mobile-menu-links a').forEach(link => {
      link.addEventListener('click', closeMobileMenu);
    });

    // ===== MOBILE DROPDOWN TOGGLES =====
    document.querySelectorAll('.mobile-dropdown-trigger').forEach(trigger => {
      trigger.addEventListener('click', (e) => {
        e.preventDefault();
        const parent = trigger.closest('.mobile-has-dropdown');
        const isActive = parent.classList.contains('active');

        // Close all other dropdowns
        document.querySelectorAll('.mobile-has-dropdown.active').forEach(dropdown => {
          if (dropdown !== parent) {
            dropdown.classList.remove('active');
          }
        });

        // Toggle current dropdown
        parent.classList.toggle('active');
      });
    });

    // ===== FLOATING PHOTOS ANIMATION =====
    document.querySelectorAll('.float-photo').forEach((photo, i) => {
      gsap.to(photo, {
        y: -12,
        duration: 2.5 + (i % 3) * 0.5,
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true,
        delay: i * 0.25
      });
    });

    // ===== SCROLL TRIGGERED ANIMATIONS =====
    document.querySelectorAll('.animate-on-scroll').forEach((el) => {
      gsap.set(el, { opacity: 0, y: 30 }); // Ensure initial state is set by GSAP

      ScrollTrigger.create({
        trigger: el,
        start: "top 85%",
        once: true,
        onEnter: () => {
          gsap.to(el, {
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: "power3.out"
          });
        }
      });
    });

    // ===== NAVBAR ENTRANCE =====
    gsap.from('.navbar-inner', {
      y: -50,
      opacity: 0,
      duration: 1,
      ease: "power3.out",
      delay: 0.2
    });

    // ===== HERO ENTRANCE ANIMATION =====
    const heroTl = gsap.timeline({ delay: 0.5 });
    heroTl.from('.hero h1', {
      y: 60,
      opacity: 0,
      duration: 1,
      ease: "power3.out"
    })
      .from('.hero p', {
        y: 30,
        opacity: 0,
        duration: 0.8,
        ease: "power3.out"
      }, "-=0.5")
      .from('.btn-hero', {
        scale: 0.8,
        opacity: 0,
        duration: 0.6,
        ease: "back.out(1.7)"
      }, "-=0.4")
      .from('.tiny', {
        scale: 0.8,
        opacity: 0,
        duration: 0.6,
        ease: "back.out(1.7)"
      }, "-=0.4");

    // ===== INSIGHT PILL ROTATOR =====
    const insightPill = document.getElementById('insightPill');
    if (insightPill) {
      const insights = [
        { text: 'Basic Cyber Awareness', color: 'dot-cyan', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>' },
        { text: 'Spot Signs of Phishing', color: 'dot-red', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>' },
        { text: 'Crisis Preparation', color: 'dot-cyan', icon: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>' },
      ];
      let insightIdx = 0;
      gsap.set(insightPill, { force3D: true });

      setInterval(() => {
        insightIdx = (insightIdx + 1) % insights.length;
        const text = document.getElementById('insightText');
        const dot = insightPill.querySelector('.dot');

        gsap.to(insightPill, {
          opacity: 0,
          y: -10,
          duration: 0.3,
          ease: "power2.in",
          onComplete: () => {
            text.textContent = insights[insightIdx].text;
            dot.className = 'dot ' + insights[insightIdx].color;
            dot.innerHTML = insights[insightIdx].icon;
            gsap.fromTo(insightPill,
              { opacity: 0, y: 10 },
              { opacity: 1, y: 0, duration: 0.4, ease: "power2.out" }
            );
          }
        });
      }, 3000);
    }

    // ===== LOGO CAROUSEL =====
    // Only run if integrations section exists
    const logoName = document.getElementById('logoName');
    const logoDesc = document.getElementById('logoDesc');
    if (logoName && logoDesc) {
      const logoCards = document.querySelectorAll('.logo-card');
      const logoLabel = document.getElementById('logoLabel');
      let activeLogoIdx = 2;

      function setActiveLogo(idx, animate = true) {
        activeLogoIdx = idx;
        const card = logoCards[idx];

        if (animate) {
          gsap.to(logoLabel, {
            opacity: 0,
            y: 10,
            duration: 0.2,
            ease: "power2.in",
            onComplete: () => {
              logoName.textContent = card.dataset.name;
              logoDesc.textContent = card.dataset.desc;
              gsap.to(logoLabel, {
                opacity: 1,
                y: 0,
                duration: 0.3,
                ease: "power2.out"
              });
            }
          });
        } else {
          logoName.textContent = card.dataset.name;
          logoDesc.textContent = card.dataset.desc;
        }
      }

      logoCards.forEach((card, i) => {
        card.addEventListener('mouseenter', () => {
          setActiveLogo(i);
          gsap.to(card, {
            scale: 1.15,
            y: -15,
            rotation: 0,
            duration: 0.4,
            ease: "power2.out"
          });
        });
        card.addEventListener('mouseleave', () => {
          const rotations = [-12, -6, 0, 6, 12];
          const yOffsets = [20, -5, -15, -5, 20];
          gsap.to(card, {
            scale: i === 2 ? 1.15 : 1,
            y: yOffsets[i],
            rotation: rotations[i],
            duration: 0.4,
            ease: "power2.out"
          });
        });
      });

      let logoInterval = setInterval(() => {
        activeLogoIdx = (activeLogoIdx + 1) % logoCards.length;
        setActiveLogo(activeLogoIdx);
      }, 3000);

      const logosCarousel = document.getElementById('logosCarousel');
      if (logosCarousel) {
        logosCarousel.addEventListener('mouseenter', () => clearInterval(logoInterval));
        logosCarousel.addEventListener('mouseleave', () => {
          logoInterval = setInterval(() => {
            activeLogoIdx = (activeLogoIdx + 1) % logoCards.length;
            setActiveLogo(activeLogoIdx);
          }, 3000);
        });
      }
    } // End of logo carousel if block


    // ===== FEATURE CARDS HOVER EFFECTS =====
    document.querySelectorAll('.feature-card').forEach(card => {
      // Set initial state for GPU acceleration
      gsap.set(card, { force3D: true, willChange: "transform" });

      card.addEventListener('mouseenter', () => {
        gsap.to(card, {
          y: -8,
          duration: 0.35,
          ease: "power2.out",
          overwrite: "auto"
        });
      });
      card.addEventListener('mouseleave', () => {
        gsap.to(card, {
          y: 0,
          duration: 0.35,
          ease: "power2.out",
          overwrite: "auto"
        });
      });
    });

    // ===== BUTTON HOVER EFFECTS =====
    document.querySelectorAll('.btn-hero, .btn-purple, .btn-demo').forEach(btn => {
      btn.addEventListener('mouseenter', () => {
        gsap.to(btn, { y: -2, scale: 1.02, duration: 0.25, ease: "power2.out" });
      });
      btn.addEventListener('mouseleave', () => {
        gsap.to(btn, { y: 0, scale: 1, duration: 0.25, ease: "power2.out" });
      });
    });

    // ===== TEAM FACES ORBIT ANIMATION =====
    document.querySelectorAll('.team-face').forEach((face, i) => {
      gsap.set(face, { force3D: true });
      gsap.to(face, {
        y: "+=5",
        duration: 1.5 + (i * 0.2),
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true,
        delay: i * 0.15
      });
    });

    // ===== INSIGHTS ORBIT PULSE =====
    gsap.set('.insights-orbit', { force3D: true });
    gsap.to('.insights-orbit', {
      scale: 1.05,
      opacity: 0.7,
      duration: 2,
      ease: "sine.inOut",
      repeat: -1,
      yoyo: true
    });

    // ===== LEGAL DOCS SHUFFLE =====
    document.querySelectorAll('.legal-doc').forEach((doc, i) => {
      gsap.set(doc, { force3D: true });
      gsap.to(doc, {
        rotation: `+=${(i - 1) * 2}`,
        y: "+=3",
        duration: 2 + i * 0.3,
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true,
        delay: i * 0.2
      });
    });

    // ===== NAV LINKS HOVER =====
    document.querySelectorAll('.nav-links a').forEach(link => {
      link.addEventListener('mouseenter', () => {
        gsap.to(link, { backgroundColor: "rgba(245,245,247,1)", color: "#111", duration: 0.25, ease: "power2.out" });
      });
      link.addEventListener('mouseleave', () => {
        gsap.to(link, { backgroundColor: "rgba(245,245,247,0)", color: "#5A5B60", duration: 0.25, ease: "power2.out" });
      });
    });

    // ===== SIGN IN BUTTON HOVER =====
    document.querySelectorAll('.btn-signin').forEach(btn => {
      btn.addEventListener('mouseenter', () => {
        gsap.to(btn, { borderColor: "#9B9CA1", duration: 0.2, ease: "power2.out" });
      });
      btn.addEventListener('mouseleave', () => {
        gsap.to(btn, { borderColor: "#E8E9ED", duration: 0.2, ease: "power2.out" });
      });
    });

    // ===== SOCIAL ICONS HOVER =====
    document.querySelectorAll('.social-icon').forEach(icon => {
      icon.addEventListener('mouseenter', () => {
        gsap.to(icon, { backgroundColor: "#7A7B80", color: "#fff", scale: 1.1, duration: 0.25, ease: "power2.out" });
      });
      icon.addEventListener('mouseleave', () => {
        gsap.to(icon, { backgroundColor: "#E8E9ED", color: "#111", scale: 1, duration: 0.25, ease: "power2.out" });
      });
    });

    // ===== FOOTER LINKS HOVER =====
    document.querySelectorAll('.footer-col ul li a').forEach(link => {
      link.addEventListener('mouseenter', () => {
        gsap.to(link, { color: "#1E3C72", x: 3, duration: 0.2, ease: "power2.out" });
      });
      link.addEventListener('mouseleave', () => {
        gsap.to(link, { color: "#111", x: 0, duration: 0.2, ease: "power2.out" });
      });
    });

    // ===== FULL-SCREEN NETWORK ANIMATION =====
    (function () {
      const canvas = document.getElementById('networkCanvas');
      const ctx = canvas.getContext('2d');
      let nodes = [];
      const nodeCount = 50;
      const connectionDistance = 180;
      let dpr = 1;
      let canvasWidth = 0;
      let canvasHeight = 0;

      // Colors
      const colors = {
        lineGrey: 'rgba(120, 120, 130, 0.15)',
        lineRed: 'rgba(232, 80, 58, 0.12)',
        nodeBlue: 'rgba(30, 60, 114, 0.6)',
        nodeRed: 'rgba(232, 80, 58, 0.5)'
      };

      function resize() {
        dpr = window.devicePixelRatio || 1;
        canvasWidth = window.innerWidth;
        canvasHeight = window.innerHeight;

        // Set display size
        canvas.style.width = canvasWidth + 'px';
        canvas.style.height = canvasHeight + 'px';

        // Set actual size in memory (scaled for retina)
        canvas.width = canvasWidth * dpr;
        canvas.height = canvasHeight * dpr;

        // Scale context to match
        ctx.scale(dpr, dpr);
      }

      function createNodes() {
        nodes = [];
        for (let i = 0; i < nodeCount; i++) {
          const isRed = Math.random() > 0.7;
          nodes.push({
            x: Math.random() * canvasWidth,
            y: Math.random() * canvasHeight,
            vx: (Math.random() - 0.5) * 0.5,
            vy: (Math.random() - 0.5) * 0.5,
            radius: Math.random() * 4 + 2,
            color: isRed ? colors.nodeRed : colors.nodeBlue,
            lineColor: isRed ? colors.lineRed : colors.lineGrey
          });
        }
      }

      function animate() {
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);

        // Update and draw nodes
        nodes.forEach((node, i) => {
          // Update position
          node.x += node.vx;
          node.y += node.vy;

          // Bounce off edges
          if (node.x < 0 || node.x > canvasWidth) node.vx *= -1;
          if (node.y < 0 || node.y > canvasHeight) node.vy *= -1;

          // Keep in bounds
          node.x = Math.max(0, Math.min(canvasWidth, node.x));
          node.y = Math.max(0, Math.min(canvasHeight, node.y));

          // Draw connections to nearby nodes
          for (let j = i + 1; j < nodes.length; j++) {
            const other = nodes[j];
            const dx = other.x - node.x;
            const dy = other.y - node.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < connectionDistance) {
              const opacity = 1 - (distance / connectionDistance);
              ctx.beginPath();
              ctx.moveTo(node.x, node.y);
              ctx.lineTo(other.x, other.y);
              // Alternate line colors
              const lineColor = (i + j) % 3 === 0 ? colors.lineRed : colors.lineGrey;
              ctx.strokeStyle = lineColor.replace(/[\d.]+\)$/, (opacity * 0.3) + ')');
              ctx.lineWidth = 1;
              ctx.stroke();
            }
          }

          // Draw node
          ctx.beginPath();
          ctx.arc(node.x, node.y, node.radius, 0, Math.PI * 2);
          ctx.fillStyle = node.color;
          ctx.fill();
        });

        requestAnimationFrame(animate);
      }

      // Initialize
      resize();
      createNodes();
      animate();

      // Handle resize
      window.addEventListener('resize', () => {
        resize();
        createNodes();
      });

      // GSAP pulse effect on random nodes
      function pulseRandomNode() {
        if (nodes.length > 0) {
          const randomNode = nodes[Math.floor(Math.random() * nodes.length)];
          const originalRadius = randomNode.radius;
          gsap.to(randomNode, {
            radius: originalRadius * 2,
            duration: 0.5,
            ease: "power2.out",
            yoyo: true,
            repeat: 1,
            onComplete: () => {
              randomNode.radius = originalRadius;
            }
          });
        }
        gsap.delayedCall(Math.random() * 2 + 0.5, pulseRandomNode);
      }
      pulseRandomNode();
    })();

    // ===== STAGGER IN CHART BARS =====
    gsap.from('.chart-row .bar', {
      scaleY: 0,
      transformOrigin: "bottom",
      duration: 0.6,
      stagger: 0.05,
      ease: "back.out(1.7)",
      scrollTrigger: {
        trigger: '.card-attendance',
        start: "top 80%"
      }
    });

    // ===== MINI BARS ANIMATION =====
    gsap.from('.mini-bar', {
      scaleY: 0,
      transformOrigin: "bottom",
      duration: 0.5,
      stagger: 0.08,
      ease: "back.out(1.5)",
      scrollTrigger: {
        trigger: '.training-chart',
        start: "top 80%"
      }
    });

    // ===== BLOCKED SITES BARS ANIMATION =====
    const blockedBars = document.querySelectorAll('.blocked-bar');
    const blockedValues = document.querySelectorAll('.blocked-value');

    if (blockedBars.length > 0) {
      ScrollTrigger.create({
        trigger: '.card-blocked',
        start: "top 80%",
        onEnter: () => {
          // Animate bars
          blockedBars.forEach((bar, i) => {
            const targetWidth = bar.dataset.width;
            gsap.to(bar, {
              width: targetWidth + '%',
              duration: 1,
              delay: i * 0.15,
              ease: "power2.out"
            });
          });

          // Animate counter values
          blockedValues.forEach((val, i) => {
            const targetValue = parseInt(val.dataset.value);
            const counter = { value: 0 };
            gsap.to(counter, {
              value: targetValue,
              duration: 1,
              delay: i * 0.15,
              ease: "power2.out",
              onUpdate: () => {
                val.textContent = Math.round(counter.value);
              }
            });
          });
        },
        once: true
      });
    }
  </script>

</body>

</html>